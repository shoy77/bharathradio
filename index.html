<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bharath Radio</title>
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="icons/icon-192.png" />
    <meta name="theme-color" content="#2196f3" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --ios-blur: rgba(18, 18, 20, 0.95);
            --accent: #00d2ff;
            --card-bg: rgba(255, 255, 255, 0.04);
            --led-blue: #007bff;
            --led-green: #28a745;
            --led-yellow: #ffc107;
            --led-red: #dc3545;
        }

        body {
            margin: 0; background-color: #000; color: #fff;
            font-family: -apple-system, system-ui, sans-serif;
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        #dynamic-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 50%, #222 0%, #000 100%);
            z-index: -1; transition: background 1.2s ease; filter: blur(70px);
        }

        header { padding: 45px 20px 10px; display: flex; justify-content: space-between; align-items: flex-end; }
        header h1 { font-size: 1.8rem; margin: 0; font-weight: 800; letter-spacing: -1px; }

        .scroller {
            flex: 1; overflow-y: auto; padding: 10px 10px 150px;
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;
            -webkit-overflow-scrolling: touch;
        }

        .station-card {
            background: var(--card-bg); backdrop-filter: blur(15px);
            border-radius: 22px; padding: 10px;
            display: flex; flex-direction: column; align-items: center;
            border: 1px solid rgba(255,255,255,0.06);
            transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .station-card:active { transform: scale(0.93); background: rgba(255,255,255,0.08); }
        .station-card.active { border-color: var(--accent); background: rgba(0, 210, 255, 0.05); }

        .station-card img {
            width: 100%; aspect-ratio: 1; border-radius: 14px;
            object-fit: cover; margin-bottom: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        .station-card span {
            font-size: 0.7rem; font-weight: 600; text-align: center;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 100%;
        }

        .ios-player {
            position: fixed; bottom: 25px; left: 15px; right: 15px;
            background: var(--ios-blur); backdrop-filter: blur(40px);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 32px;
            padding: 16px 20px; box-shadow: 0 25px 50px rgba(0,0,0,0.7);
            z-index: 1000;
        }

        .led-meter {
            display: flex; gap: 3px; height: 8px; width: 100%;
            margin-bottom: 15px; justify-content: center;
            background: rgba(0,0,0,0.3); padding: 4px; border-radius: 4px;
        }
        .led-seg { flex: 1; height: 100%; border-radius: 1.5px; background: #222; transition: 0.08s; }

        .player-main { display: flex; align-items: center; justify-content: space-between; gap: 15px; }
        .mini-info { display: flex; align-items: center; gap: 12px; flex: 1; overflow: hidden; }
        .mini-info img { width: 46px; height: 46px; border-radius: 10px; }
        #st-name { font-weight: 700; font-size: 1rem; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        #st-status { font-size: 0.65rem; color: var(--accent); font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }

        .play-btn {
            width: 50px; height: 50px; background: #fff;
            color: #000; border: none; border-radius: 50%;
            font-size: 1.2rem; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* Hidden YouTube Container */
        #yt-player-container { position: absolute; top: -9999px; left: -9999px; visibility: hidden; }
    </style>
</head>
<body>

<div id="dynamic-bg"></div>

<header>
    <h1>Bharath Radio</h1>
    <span id="clock" style="font-weight: 800; font-size: 1rem;">00:00</span>
</header>

<div class="scroller" id="grid"></div>

<footer class="ios-player">
    <div class="led-meter" id="ledMeter"></div>
    <div class="player-main">
        <div class="mini-info">
            <img src="https://via.placeholder.com/50" id="cur-img">
            <div class="text-group">
                <span id="st-status">SYSTEM READY</span>
                <span id="st-name">Select Station</span>
            </div>
        </div>
        <button class="play-btn" id="playBtn" onclick="togglePlay()"><i class="fas fa-play"></i></button>
    </div>
</footer>

<audio id="audio" crossorigin="anonymous"></audio>
<div id="yt-player-container"><div id="yt-player"></div></div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://www.youtube.com/iframe_api"></script>

<script>
    const audio = document.getElementById('audio');
    const hls = new Hls();
    let audioCtx, analyser, dataArray, ytPlayer;
    let currentStationType = 'radio'; // 'radio' or 'youtube'

    const stations = [
        { name: "Asianet News", url: "tXRuaacO-ZU", type: "youtube", img: "https://images.seeklogo.com/logo-png/34/1/asianet-news-logo-png_seeklogo-343770.png", color: "#991b1b" },
        { name: "24 News", url: "1wECsnGZcfc", type: "youtube", img: "https://play-lh.googleusercontent.com/Ihz9rtDugAP2812ChLj9anK_Go7ZZQLHWY9NqfjuwbEfuhTM6-W6WZnx7dFKwA4mgIsu", color: "#1e3a8a" },
        { name: "Reporter TV", url: "nObUcHKZEGY", type: "youtube", img: "https://play-lh.googleusercontent.com/62BvMwIRmEPfX6Ozi3rHOF7mzfVzxGydfFPyPWugknwt6MqgKSDA2YwmFPOtk5cfg-UW", color: "#166534" },

        { name: "Radio Kerala", url: "https://streaming.radiokerala.in/listen/radio_kerala/radio.mp3", type: "radio", img: "https://radiosindia.com/images/keralaradio1.jpg", color: "#1e3a8a" },
        { name: "Radio Suno", url: "https://a1.asurahosting.com/listen/radio_suno_87.6fm/radio.mp3", type: "radio", img: "https://radiosindia.com/images/radiosunobh.jpg", color: "#6b21a8" },
        { name: "Radio Mango", url: "https://listen.openstream.co/4635/audio", type: "radio", img: "https://liveradios.in/wp-content/uploads/radiomango.jpg", color: "#991b1b" },
        { name: "Suryan FM", url: "https://strw3.openstream.co/562", type: "radio", img: "https://liveradios.in/wp-content/uploads/suryanfm.jpg", color: "#166534" },
        { name: "Ananthapuri", url: "https://air.pc.cdn.bitgravity.com/air/live/pbaudio229/playlist.m3u8", type: "radio", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSuwneMST8tcETyh30ManutUuzplTkEE6AS68GdVkGLUwCV7Jn4c_DGP0M&s=10", color: "#9a3412" },
        { name: "Vividh Bharathi", url: "https://air.pc.cdn.bitgravity.com/air/live/pbaudio001/playlist.m3u8", type: "radio", img: "https://liveradios.in/wp-content/uploads/vividhbharathi.jpg", color: "#881337" },
        { name: "Ashraya FM", url: "https://fm.ashrayafm90.com/ashrayafm", type: "radio", img: "https://liveradios.in/wp-content/uploads/ashrayafm.jpg", color: "#1e3a8a" },
        { name: "Rhythm Nation", url: "https://stream.zeno.fm/dz8dvc19mexuv", type: "radio", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQP1HKAZK7QGZVKKKXehQTLw6Pc5F5cl-7l2Ytvp5s-4g&s", color: "#4c1d95" },
        { name: "Kochi FM", url: "https://air.pc.cdn.bitgravity.com/air/live/pbaudio045/playlist.m3u8", type: "radio", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR-jold_pBomv7XpJd0DLV_2l0aqHmRBtS1sAnR2cPIUPtDP3IeucN7Xjc&s=10", color: "#065f46" },
        { name: "AIR Kozhikode", url: "https://air.pc.cdn.bitgravity.com/air/live/pbaudio083/playlist.m3u8", type: "radio", img: "https://onlineradiofm.in/assets/image/radio/180/all-india-air.webp", color: "#854d0e" },
        
        { name: "Keralam", url: "http://ice31.securenetsystems.net/RADIOKERAL",type: "radio", img: "https://cdnrf.securenetsystems.net/file_radio/stations_large/RADIOKERAL/v5/album-art-default.png", color: "#3f3f46"},
        
        { name: "Tamil Dubai", url: "https://centova.aarenworld.com/proxy/894tamilfm/stream",type: "radio",img: "https://onlineradiofm.in/assets/image/radio/180/tamil894.png", color: "#c2410c" },
        { name: "ARR Radio", url: "https://s7.yesstreaming.net:8038/stream",type: "radio",img: "https://onlineradiohub.com/wp-content/uploads/2024/01/AR-Rahman-fm.jpg", color: "#064e3b" },
        { name: "Euro Dance 90s", url: "https://regiocast.streamabc.net/regc-90s90seurodance7558633-mp3-192-3419489",type: "radio", img: "https://www.radio.net/300/eurodance90.png?version=cfb442ffae6c972f0d1632d9dbf0470ef49da630", color: "#1e3a8a" }
    ];

    // Initialize YouTube API
    function onYouTubeIframeAPIReady() {
        ytPlayer = new YT.Player('yt-player', {
            height: '0', width: '0',
            playerVars: { 'autoplay': 0, 'controls': 0, 'playsinline': 1 },
            events: { 'onStateChange': onYTPStateChange }
        });
    }

    function onYTPStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING) {
            document.getElementById('playBtn').innerHTML = '<i class="fas fa-pause"></i>';
            document.getElementById('st-status').innerText = "LIVE ";
        } else {
            document.getElementById('playBtn').innerHTML = '<i class="fas fa-play"></i>';
            document.getElementById('st-status').innerText = "PAUSED";
        }
    }

    // LED Meter Setup
    const ledMeter = document.getElementById('ledMeter');
    const segCount = 20;
    for(let i=0; i < segCount; i++) {
        let seg = document.createElement('div');
        seg.className = 'led-seg';
        ledMeter.appendChild(seg);
    }

    function initAudioCtx() {
        if(audioCtx) return;
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioCtx.createAnalyser();
        const source = audioCtx.createMediaElementSource(audio);
        source.connect(analyser);
        analyser.connect(audioCtx.destination);
        analyser.fftSize = 64;
        dataArray = new Uint8Array(analyser.frequencyBinCount);
        renderLED();
    }

    function renderLED() {
        requestAnimationFrame(renderLED);
        let isActuallyPlaying = (currentStationType === 'radio' && !audio.paused) || (currentStationType === 'youtube' && ytPlayer && ytPlayer.getPlayerState() === 1);
        
        if(isActuallyPlaying) {
            let avg = 0;
            if (currentStationType === 'radio') {
                analyser.getByteFrequencyData(dataArray);
                avg = dataArray.reduce((a,b) => a+b) / dataArray.length;
            } else {
                avg = Math.random() * 100 + 40; // Simulate LED for YT as cross-origin prevents actual analysis
            }
            
            let level = Math.floor((avg / 160) * segCount);
            const segs = document.querySelectorAll('.led-seg');
            segs.forEach((seg, i) => {
                if(i < level) {
                    if(i < 5) seg.style.background = 'var(--led-blue)';
                    else if(i < 11) seg.style.background = 'var(--led-green)';
                    else if(i < 16) seg.style.background = 'var(--led-yellow)';
                    else seg.style.background = 'var(--led-red)';
                    seg.style.boxShadow = `0 0 8px ${seg.style.background}`;
                } else {
                    seg.style.background = '#222';
                    seg.style.boxShadow = 'none';
                }
            });
        }
    }

    // Build Grid
    const grid = document.getElementById('grid');
    stations.forEach(s => {
        const div = document.createElement('div');
        div.className = 'station-card';
        div.innerHTML = `<img src="${s.img}"><span>${s.name}</span>`;
        div.onclick = () => {
            initAudioCtx();
            document.querySelectorAll('.station-card').forEach(c => c.classList.remove('active'));
            div.classList.add('active');
            document.getElementById('cur-img').src = s.img;
            document.getElementById('st-name').innerText = s.name;
            document.getElementById('dynamic-bg').style.background = `radial-gradient(circle at 50% , ${s.color} 0%, #000 100%)`;
            playStation(s);
        };
        grid.appendChild(div);
    });

    function playStation(station) {
        document.getElementById('st-status').innerText = "CONNECTING";
        
        // Stop both first
        audio.pause();
        audio.src = "";
        if(ytPlayer && ytPlayer.stopVideo) ytPlayer.stopVideo();

        currentStationType = station.type;

        if (station.type === 'youtube') {
            ytPlayer.loadVideoById(station.url);
            ytPlayer.playVideo();
        } else {
            if (station.url.includes('.m3u8')) { 
                hls.loadSource(station.url); 
                hls.attachMedia(audio); 
            } else { 
                hls.detachMedia(); 
                audio.src = station.url; 
            }
            audio.play();
        }
    }

    function togglePlay() {
        if (currentStationType === 'youtube') {
            const state = ytPlayer.getPlayerState();
            state === 1 ? ytPlayer.pauseVideo() : ytPlayer.playVideo();
        } else {
            audio.paused ? audio.play() : audio.pause();
        }
    }

    // Audio Event Listeners
    audio.onplay = () => {
        document.getElementById('playBtn').innerHTML = '<i class="fas fa-pause"></i>';
        document.getElementById('st-status').innerText = "LIVE ";
    };
    audio.onpause = () => {
        document.getElementById('playBtn').innerHTML = '<i class="fas fa-play"></i>';
        document.getElementById('st-status').innerText = "PAUSED";
    };

    // Clock
    setInterval(() => {
        const d = new Date();
        let hours = d.getHours();
        const minutes = d.getMinutes().toString().padStart(2, '0');
        const ampm = hours >= 12 ? 'PM' : 'AM';
        hours = hours % 12 || 12;
        document.getElementById('clock').innerText = `${hours}:${minutes} ${ampm}`;
    }, 1000);
</script>
</body>
</html>
